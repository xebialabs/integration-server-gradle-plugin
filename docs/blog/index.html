<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<link rel="alternate" type="application/rss+xml" href="/integration-server-gradle-plugin/blog/rss.xml" title="Integration Server Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/integration-server-gradle-plugin/blog/atom.xml" title="Integration Server Blog Atom Feed"><title data-react-helmet="true">Blog | Integration Server</title><meta data-react-helmet="true" property="og:title" content="Blog | Integration Server"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://xebialabs.github.io//integration-server-gradle-plugin/blog"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="/integration-server-gradle-plugin/img/digital_ai_deploy.svg"><link data-react-helmet="true" rel="canonical" href="https://xebialabs.github.io//integration-server-gradle-plugin/blog"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io//integration-server-gradle-plugin/blog" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io//integration-server-gradle-plugin/blog" hreflang="x-default"><link rel="stylesheet" href="/integration-server-gradle-plugin/assets/css/styles.c8cb9dad.css">
<link rel="preload" href="/integration-server-gradle-plugin/assets/js/runtime~main.32fb6fb3.js" as="script">
<link rel="preload" href="/integration-server-gradle-plugin/assets/js/main.9dc28fe7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/integration-server-gradle-plugin/"><img src="/integration-server-gradle-plugin/img/digital_ai_deploy.svg" alt="Integration Server Deploy Digital.ai" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/integration-server-gradle-plugin/img/digital_ai_deploy.svg" alt="Integration Server Deploy Digital.ai" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Integration Server</b></a><a class="navbar__item navbar__link" href="/integration-server-gradle-plugin/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/integration-server-gradle-plugin/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/integration-server-gradle-plugin/docs/intro">10.4.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/integration-server-gradle-plugin/docs/intro">10.4.0</a></li><li><a class="dropdown__link" href="/integration-server-gradle-plugin/docs/10.3.0/intro">10.3.0</a></li></ul></div><a href="https://github.com/xebialabs/integration-server-gradle-plugin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT"></span></div><div class="react-toggle-track-x"><span class="toggle_71bT"></span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/integration-server-gradle-plugin/blog/2021/12/17/run-deploy-aws-efs-with-operator">How to run a Deploy Cluster on AWS EKS setup with help of operator</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/integration-server-gradle-plugin/blog/2021/12/16/run-deploy-gcp-gke-with-operator">How to run a Deploy Cluster on GCP GKE setup with help of operator</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/integration-server-gradle-plugin/blog/2021/12/13/run-deploy-azure-aks-with-operator">How to run a Deploy Cluster on Azure AKS setup with help of operator</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/integration-server-gradle-plugin/blog/2021/12/13/run-deploy-minikube-with-operator">How to run a Deploy Cluster on Minikube local setup with help of operator</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/integration-server-gradle-plugin/blog/2021/12/10/run-deploy-openshift-cluster-with-operator">How to run a Deploy Cluster on Aws OpenShift setup with help of operator</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/integration-server-gradle-plugin/blog/2021/12/17/run-deploy-aws-efs-with-operator">How to run a Deploy Cluster on AWS EKS setup with help of operator</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-12-17T00:00:00.000Z" itemprop="datePublished">December 17, 2021</time> 路 2 min read</div></header><div class="markdown" itemprop="articleBody"><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="requirements"></a>Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">#</a></h2><p>Documentation is applicable for a version <strong>10.4.0-1209.942</strong> or later.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="pre-requisites"></a>Pre-requisites<a class="hash-link" href="#pre-requisites" title="Direct link to heading">#</a></h2><p>Below are the prerequisites for the automation to run.
You need to:</p><ul><li>Install <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" target="_blank" rel="noopener noreferrer">AWS CLI locally</a> and <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html" target="_blank" rel="noopener noreferrer">Configure AWS cli</a></li><li>Install <a href="https://docs.aws.amazon.com/eks/latest/userguide/eksctl.html" target="_blank" rel="noopener noreferrer">EKSCTL locally</a></li><li>Install <a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener noreferrer">HELM locally</a></li><li>Note:  <ul><li>AWS access key and secret key should be configured either via aws configure or using gradle project properties.
&#x27;-PaccessKey= -PsecretKey=&#x27;  </li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="how-the-full-flow-works"></a>How the full flow works<a class="hash-link" href="#how-the-full-flow-works" title="Direct link to heading">#</a></h2><ul><li>Installing a docker based Deploy instance, because we will use Deploy to create necessary resources in kubernetes and to deploy an operator.</li><li>Checking out <a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer">Deploy operator</a> and modifying the configuration based on the user input</li><li>Installing <a href="https://docs.xebialabs.com/v.10.3/deploy/how-to/install-the-xl-cli/" target="_blank" rel="noopener noreferrer">XL CLI</a> to apply YAML files </li><li>Verifying that deployment was successful and all required resources were created in kubernetes. If something went wrong, you&#x27;ll be notified about it in logs.</li></ul><p>You can also check this <a href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/aws-eks" target="_blank" rel="noopener noreferrer">operator AWS EKS documentation</a> for
more information.</p><p>All of this is automated and can be triggered by <code>./gradlew clean :core:startIntegrationServer --stacktrace</code> with the configuration that is similar
to the following example.</p><p>When you would like to stop your cluster you can run <code>./gradlew  :core:shutdownIntegrationServer --stacktrace</code>.
It will undeploy all CIs, remove all deployed resources on kubernetes and clean all created PVC.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h2><p>An example for a complete configuration:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">deployIntegrationServer {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cli {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        overlays = [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ext: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        fileTree(dir: &quot;$rootDir/config/cli&quot;, includes: [&quot;**/*.py&quot;])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                lib: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;com.xebialabs.xl-platform.test-utils:py-modules:${testUtilsVersion}@jar&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cluster {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        enable = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        profile = &#x27;operator&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        publicPort = 10001</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    clusterProfiles {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        operator {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            activeProviderName = &quot;aws-eks&quot;            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            awsEks {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        name = &#x27;aws-eks-test-cluster&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        region = &#x27;us-east-1&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    servers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabsunsupported/xl-deploy&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            pingRetrySleepTime = 10</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            pingTotalTries = 120</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            version = &quot;${xlDeployTrialVersion}&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            overlays = [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    conf: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            fileTree(dir: &quot;$rootDir/config/conf&quot;, includes: [&quot;*.*&quot;])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server02 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    workers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabsunsupported/deploy-task-engine&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker02 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The cluster will be created with amount of servers and workers specified in the configuration. For this case,
it will create 2 masters and 2 workers. The final URL to connect to UI is:
<code> http://deploy.digitalai-testing.com/xl-deploy/#/explorer</code>.
In case if you want to update the operator and use your own, you can change <code>operatorImage</code>.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/integration-server-gradle-plugin/blog/tags/cluster-operator">cluster-operator</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/integration-server-gradle-plugin/blog/2021/12/16/run-deploy-gcp-gke-with-operator">How to run a Deploy Cluster on GCP GKE setup with help of operator</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-12-16T00:00:00.000Z" itemprop="datePublished">December 16, 2021</time> 路 3 min read</div></header><div class="markdown" itemprop="articleBody"><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="requirements"></a>Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">#</a></h2><p>Documentation is applicable for a version <strong>10.4.0-1209.942</strong> or later.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="pre-requisites"></a>Pre-requisites<a class="hash-link" href="#pre-requisites" title="Direct link to heading">#</a></h2><p>There are a couple of prerequisites which have to be performed in order to run the automation.
You have to:</p><ul><li>install <a href="https://cloud.google.com/sdk/docs/install" target="_blank" rel="noopener noreferrer">gcloud CLI locally</a></li><li>add to your <code>~/.gradle/properties</code> 2 values:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">accountCredFile</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">accountName</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For the <code>accountName</code> the best is to use a service account. To create a service account and get JSON file that is needed for <code>accountCredFile</code> use the following link:
<a href="https://cloud.google.com/docs/authentication/production#create_service_account" target="_blank" rel="noopener noreferrer">Creating a service account</a>. Assign to a service account following roles
on the target project:
<img alt="IAM - Permissions for project for the service account" src="/integration-server-gradle-plugin/assets/images/gcp-gke-project-permissions-081f104e3ab669c5c80194712a82b2a1.png">
More details about IAM policies for GKE are here: <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/iam" target="_blank" rel="noopener noreferrer">Create IAM policies</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="how-the-full-flow-works"></a>How the full flow works<a class="hash-link" href="#how-the-full-flow-works" title="Direct link to heading">#</a></h2><ul><li>Installing a docker based Deploy instance, because we will use Deploy to create necessary resources in kubernetes and to deploy an operator.</li><li>Checking out <a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer">Deploy operator</a> and modifying the configuration based on the user input</li><li>Installing <a href="https://docs.xebialabs.com/v.10.3/deploy/how-to/install-the-xl-cli/" target="_blank" rel="noopener noreferrer">XL CLI</a> to apply YAML files </li><li>Verifying that deployment was successful and all required resources were created in kubernetes. If something went wrong, you&#x27;ll be notified about it in logs.</li></ul><p>You can also check this <a href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/gcp-gke" target="_blank" rel="noopener noreferrer">operator GCP GKE documentation</a> for
more information.</p><p>All of this is automated and can be triggered by <code>./gradlew clean :core:startIntegrationServer --stacktrace</code> with the configuration that is similar
to the following example.</p><p>When you would like to stop your cluster you can run <code>./gradlew :core:shutdownIntegrationServer --stacktrace</code>.
It will undeploy all CIs, remove all deployed resources on kubernetes and clean all created PVC.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h2><p>An example for a complete configuration:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">deployIntegrationServer {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cli {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        overlays = [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ext: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        fileTree(dir: &quot;$rootDir/config/cli&quot;, includes: [&quot;**/*.py&quot;])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                lib: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;com.xebialabs.xl-platform.test-utils:py-modules:${testUtilsVersion}@jar&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cluster {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        enable = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        profile = &#x27;operator&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        publicPort = 10001</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    clusterProfiles {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        operator {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            activeProviderName = &quot;gcp-gke&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            gcpGke {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                name = &#x27;gcp-gke-test-cluster&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                storageClass = &#x27;standard-rwo&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                accountName = &#x27;gcp-gke-test-cluster@apollo-playground.iam.gserviceaccount.com&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                projectName = &#x27;apollo-playground&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                regionZone = &#x27;us-central1-a&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                clusterNodeCount = 3</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                clusterNodeVmSize = &#x27;e2-standard-2&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    servers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabsunsupported/xl-deploy&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            pingRetrySleepTime = 10</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            pingTotalTries = 120</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            version = &quot;${xlDeployTrialVersion}&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            overlays = [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    conf: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            fileTree(dir: &quot;$rootDir/config/conf&quot;, includes: [&quot;*.*&quot;])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server02 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    workers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabsunsupported/deploy-task-engine&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker02 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The cluster will be created with amount of servers and workers specified in the configuration. For this case,
it will create 2 masters and 2 workers. The final URL to connect to UI is:
<code>http://gcp-gke-test-cluster.endpoints.apollo-playground.cloud.goog/xl-deploy/#/explorer</code> (composed of operator provider name and location).
In case if you want to update the operator and use your own, you can change <code>operatorImage</code>.
Cluster will create with 3 cluster nodes with cluster node-vm-size <code>e2-standard-2</code> with 8GB and 4vCPU.<br>
The geo zone of the cluster will be <code>us-central1-a</code>, check with <code>gcloud compute zones list</code> for other location.
Storage class here will be used <code>standard-rwo</code> that is enabled with addon <code>GcePersistentDiskCsiDriver</code> during cluster creation. For details check
<a href="https://cloud.google.com/kubernetes-engine/docs/how-to/persistent-volumes/gce-pd-csi-driver" target="_blank" rel="noopener noreferrer">Using the Compute Engine persistent disk CSI Driver</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/integration-server-gradle-plugin/blog/tags/cluster-operator">cluster-operator</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/integration-server-gradle-plugin/blog/2021/12/13/run-deploy-azure-aks-with-operator">How to run a Deploy Cluster on Azure AKS setup with help of operator</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-12-13T00:00:00.000Z" itemprop="datePublished">December 13, 2021</time> 路 2 min read</div></header><div class="markdown" itemprop="articleBody"><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="requirements"></a>Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">#</a></h2><p>Documentation is applicable for a version <strong>10.4.0-1209.942</strong> or later.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="pre-requisites"></a>Pre-requisites<a class="hash-link" href="#pre-requisites" title="Direct link to heading">#</a></h2><p>There are a couple of prerequisites which have to be performed in order to run the automation.
You have to:</p><ul><li>You should install <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" target="_blank" rel="noopener noreferrer">Azure CLI locally</a></li><li>add to your <code>~/.gradle/properties</code> 2 values:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">azUsername</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">azPassword</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="how-the-full-flow-works"></a>How the full flow works<a class="hash-link" href="#how-the-full-flow-works" title="Direct link to heading">#</a></h2><ul><li>Installing a docker based Deploy instance, because we will use Deploy to create necessary resources in kubernetes and to deploy an operator.</li><li>Checking out <a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer">Deploy operator</a> and modifying the configuration based on the user input</li><li>Installing <a href="https://docs.xebialabs.com/v.10.3/deploy/how-to/install-the-xl-cli/" target="_blank" rel="noopener noreferrer">XL CLI</a> to apply YAML files </li><li>Verifying that deployment was successful and all required resources were created in kubernetes. If something went wrong, you&#x27;ll be notified about it in logs.</li></ul><p>You can also check this <a href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/azure-aks" target="_blank" rel="noopener noreferrer">operator Azure AKS documentation</a> for
more information.</p><p>All of this is automated and can be triggered by <code>./gradlew clean :core:startIntegrationServer --stacktrace</code> with the configuration that is similar
to the following example.</p><p>When you would like to stop your cluster you can run <code>./gradlew  :core:shutdownIntegrationServer --stacktrace</code>.
It will undeploy all CIs, remove all deployed resources on kubernetes and clean all created PVC.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h2><p>An example for a complete configuration:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">deployIntegrationServer {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cli {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        overlays = [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ext: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        fileTree(dir: &quot;$rootDir/config/cli&quot;, includes: [&quot;**/*.py&quot;])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                lib: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;com.xebialabs.xl-platform.test-utils:py-modules:${testUtilsVersion}@jar&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cluster {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        enable = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        profile = &#x27;operator&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        publicPort = 10001</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    clusterProfiles {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        operator {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            activeProviderName = &quot;azure-aks&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            azureAks {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                name = &#x27;azure-aks-test-cluster&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                clusterNodeCount = 3</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                clusterNodeVmSize = &#x27;Standard_DS2_v2&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                location = &#x27;northcentralus&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    servers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabsunsupported/xl-deploy&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            pingRetrySleepTime = 10</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            pingTotalTries = 120</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            version = &quot;${xlDeployTrialVersion}&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            overlays = [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    conf: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            fileTree(dir: &quot;$rootDir/config/conf&quot;, includes: [&quot;*.*&quot;])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server02 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    workers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabsunsupported/deploy-task-engine&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker02 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The cluster will be created with amount of servers and workers specified in the configuration. For this case,
it will create 2 masters and 2 workers. The final URL to connect to UI is:
<code>http://azure-aks-test-cluster.northcentralus.cloudapp.azure.com/xl-deploy/#/explorer</code> (composed of operator provider name and location).
In case if you want to update the operator and use your own, you can change <code>operatorImage</code>.
Cluster will create with 3 cluster nodes with default node-vm-size <code>Standard_DS2_v2</code> with 7GiB and 2vCPU.
The location of the cluster will be <code>northcentralus</code>, check with <code>az account list-locations</code> for other location.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/integration-server-gradle-plugin/blog/tags/cluster-operator">cluster-operator</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/integration-server-gradle-plugin/blog/2021/12/13/run-deploy-minikube-with-operator">How to run a Deploy Cluster on Minikube local setup with help of operator</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-12-13T00:00:00.000Z" itemprop="datePublished">December 13, 2021</time> 路 3 min read</div></header><div class="markdown" itemprop="articleBody"><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="requirements"></a>Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">#</a></h2><p>Documentation is applicable for a version <strong>10.4.0-1209.942</strong> or later.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="pre-requisites"></a>Pre-requisites<a class="hash-link" href="#pre-requisites" title="Direct link to heading">#</a></h2><p>There are a couple of prerequisites which have to be performed in order to run the automation.
You have to:</p><ul><li><a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener noreferrer">install minikube on your machine</a>.</li><li>the plugin is using <a href="https://minikube.sigs.k8s.io/docs/drivers/virtualbox/" target="_blank" rel="noopener noreferrer">virtualbox driver</a>
so <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener noreferrer">install virtualbox on your machine</a>. </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="how-the-full-flow-works"></a>How the full flow works<a class="hash-link" href="#how-the-full-flow-works" title="Direct link to heading">#</a></h2><ul><li>Installing a docker based Deploy instance, because we will use Deploy to create necessary resources in kubernetes and to deploy an operator.</li><li>Checking out <a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer">Deploy operator</a> and modifying the configuration based on the user input</li><li>Installing <a href="https://docs.xebialabs.com/v.10.3/deploy/how-to/install-the-xl-cli/" target="_blank" rel="noopener noreferrer">XL CLI</a> to apply YAML files </li><li>Verifying that deployment was successful and all required resources were created in kubernetes. If something went wrong, you&#x27;ll be notified about it in logs.</li></ul><p>You can also check this <a href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/onprem" target="_blank" rel="noopener noreferrer">documentation</a> for more information.</p><p>All of this is automated and can be triggered by <code>./gradlew clean :core:startIntegrationServer --stacktrace</code> with the configuration that is similar
to the following example.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>During cluster setup there will be info line, similar to the following:
&quot;Please enter your password if requested for user ${current_username} or give user sudoers permissions &#x27;${current_username} ALL=(ALL) NOPASSWD: ${path_to_script}/update_etc_hosts.sh&#x27;.&quot;
where placeholders ${current_username} and ${path_to_script} will be replaced with correct values.</p><p>Update your <code>/etc/sudoers</code> file according to the info line that will be provided in the console log. If you didn&#x27;t do that on time:</p><ul><li>stop current build and rerun full installation after update of <code>/etc/sudoers</code></li><li>or run following script: <code>sudo &quot;${path_to_script}/update_etc_hosts.sh&quot;</code></li></ul></div></div><p>When you would like to stop your cluster you can run <code>./gradlew  :core:shutdownIntegrationServer --stacktrace</code>.
It will undeploy all CIs, remove all deployed resources on kubernetes and clean all created PVC.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h2><p>An example for a complete configuration:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">deployIntegrationServer {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cli {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        overlays = [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ext: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        fileTree(dir: &quot;$rootDir/config/cli&quot;, includes: [&quot;**/*.py&quot;])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                lib: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;com.xebialabs.xl-platform.test-utils:py-modules:${testUtilsVersion}@jar&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cluster {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        enable = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        profile = &#x27;operator&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        publicPort = 10001</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    clusterProfiles {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        operator {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            activeProviderName = &quot;onprem&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            onPremise {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                name = &#x27;onprem-test-cluster&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                clusterNodeCpus = 4</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                clusterNodeMemory = 15000</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    servers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabsunsupported/xl-deploy&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            pingRetrySleepTime = 10</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            pingTotalTries = 120</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            version = &quot;${xlDeployTrialVersion}&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            overlays = [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                conf: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    fileTree(dir: &quot;$rootDir/config/conf&quot;, includes: [&quot;*.*&quot;])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server02 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    workers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabsunsupported/deploy-task-engine&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker02 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The cluster will be created with amount of servers and workers specified in the configuration. For this case,
it will create 2 masters and 2 workers. The final URL to connect to UI is: <code>http://onprem-test-cluster.digitalai-testing.com/xl-deploy/#/explorer</code>.
In case if you want to update the operator and use your own, you can change <code>operatorImage</code>.
Cluster will use virtualbox with 4 CPUs and 15000MB memory.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/integration-server-gradle-plugin/blog/tags/cluster-operator">cluster-operator</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/integration-server-gradle-plugin/blog/2021/12/10/run-deploy-openshift-cluster-with-operator">How to run a Deploy Cluster on Aws OpenShift setup with help of operator</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-12-10T00:00:00.000Z" itemprop="datePublished">December 10, 2021</time> 路 2 min read</div></header><div class="markdown" itemprop="articleBody"><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="requirements"></a>Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">#</a></h2><p>Documentation is applicable for a version <strong>10.4.0-1209.942</strong> or later.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="pre-requisites"></a>Pre-requisites<a class="hash-link" href="#pre-requisites" title="Direct link to heading">#</a></h2><p>There are a couple of prerequisites which have to be performed in order to run the automation.
You have to:</p><ul><li><a href="https://docs.openshift.com/rosa/rosa_getting_started/rosa-creating-cluster.html" target="_blank" rel="noopener noreferrer">create a cluster itself on AWS OpenShift</a>.</li><li><a href="https://docs.openshift.com/container-platform/4.2/cli_reference/openshift_cli/getting-started-cli.html" target="_blank" rel="noopener noreferrer">install oc on your machine</a>. </li><li>add to your <code>~/.gradle/properties</code> 2 values:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">ocLogin</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ocPassword</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><a href="https://docs.openshift.com/container-platform/4.2/storage/persistent_storage/persistent-storage-efs.html" target="_blank" rel="noopener noreferrer">create EFS class storage</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="how-the-full-flow-works"></a>How the full flow works<a class="hash-link" href="#how-the-full-flow-works" title="Direct link to heading">#</a></h2><ul><li>Installing a docker based Deploy instance, because we will use Deploy to create necessary resources in kubernetes and to deploy an operator.</li><li>Checking out <a href="https://github.com/xebialabs/xl-deploy-kubernetes-operator" target="_blank" rel="noopener noreferrer">Deploy operator</a> and modifying the configuration based on the user input</li><li>Installing <a href="https://docs.xebialabs.com/v.10.3/deploy/how-to/install-the-xl-cli/" target="_blank" rel="noopener noreferrer">XL CLI</a> to apply YAML files </li><li>Verifying that deployment was successful and all required resources were created in kubernetes. If something went wrong, you&#x27;ll be notified about it in logs.</li></ul><p>You can also check this <a href="https://xebialabs.github.io/xl-deploy-kubernetes-operator/docs/manual/openshift" target="_blank" rel="noopener noreferrer">documentation</a> for
more information.</p><p>All of this is automated and can be triggered by <code>./gradlew clean :core:startIntegrationServer --stacktrace</code> with the configuration that is similar
to the following example.</p><p>When you would like to stop your cluster you can run <code>./gradlew  :core:shutdownIntegrationServer --stacktrace</code>.
It will undeploy all CIs, remove all deployed resources on kubernetes and clean all created PVC.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h2><p>An example for a complete configuration:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">deployIntegrationServer {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cli {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        overlays = [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ext: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        fileTree(dir: &quot;$rootDir/config/cli&quot;, includes: [&quot;**/*.py&quot;])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                lib: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;com.xebialabs.xl-platform.test-utils:py-modules:${testUtilsVersion}@jar&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cluster {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        enable = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        profile = &#x27;operator&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        publicPort = 10001</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    clusterProfiles {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        operator {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            activeProviderName = &quot;aws-openshift&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            awsOpenshift {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                apiServerURL = &#x27;https://api.yourhost.lnfl.p1.openshiftapps.com:6443&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                host = &#x27;router-default.apps.yourhost.lnfl.p1.openshiftapps.com&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                name = &#x27;aws-openshift-test-cluster&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                oauthHostName = &quot;oauth-openshift.apps.yourhost.lnfl.p1.openshiftapps.com&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                operatorImage = &#x27;acierto/deploy-operator:1.0.6-openshift&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                operatorPackageVersion = &quot;1.0.1&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    servers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabsunsupported/xl-deploy&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            pingRetrySleepTime = 10</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            pingTotalTries = 120</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            version = &quot;${xlDeployTrialVersion}&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server02 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    workers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabsunsupported/deploy-task-engine&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker02 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The cluster will be created with amount of servers and workers specified in the configuration. For this case,
it will create 2 masters and 2 workers. The final URL to connect to UI is: <code>router-default.apps.yourhost.lnfl.p1.openshiftapps.com</code>.
In case if you want to update the operator and use your own, you can change <code>operatorImage</code>. As you can see from this
example, that&#x27;s exactly what happened. <code>acierto/deploy-operator:1.0.6-openshift</code> is not the official operator.
Information about <code>apiServerURL</code>, <code>host</code> and <code>oauthHostName</code> you should check in your OpenShift Cluster console.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/integration-server-gradle-plugin/blog/tags/cluster-operator">cluster-operator</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/integration-server-gradle-plugin/blog/2021/12/08/run-kube-scanning-test">How to run a Kube Scanning tests</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-12-08T00:00:00.000Z" itemprop="datePublished">December 8, 2021</time> 路 2 min read</div></header><div class="markdown" itemprop="articleBody"><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h3><p>Create your Kube scanning test, for your custom plugin in against running kubernetes cluster.
Here we are using the <a href="https://github.com/aquasecurity/kube-bench/tree/0d1bd2bbd95608957be024c12d03a0510325e5e2" target="_blank" rel="noopener noreferrer">Kube-bench</a> tool that checks the Kubernetes cluster is deployed securely by running the necessary checks documented in the CIS Kubernetes Benchmark.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="build-gradle-configuration-for-kube-scanner"></a>Build gradle configuration for kube scanner<a class="hash-link" href="#build-gradle-configuration-for-kube-scanner" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">deployIntegrationServer {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubeScanner {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        awsRegion = &#x27;eu-west-1&#x27; </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        logOutput = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        kubeBenchTagVersion = &quot;v0.6.5&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        command = [&quot;-v&quot;, &quot;3&quot;, &quot;logtostrerr&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><table><thead><tr><th align="center">Name</th><th align="center">Type</th><th align="center">Default Value</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center">awsRegion</td><td align="center">Optional</td><td align="center"></td><td align="center">By default it will read from config [~/.aws/config] file.</td></tr><tr><td align="center">logOutput</td><td align="center">Optional</td><td align="center">false</td><td align="center">To Log the command and output executed while running the test.</td></tr><tr><td align="center">kubeBenchTagVersion</td><td align="center">Optional</td><td align="center">latest</td><td align="center">By default it will use the latest main branch.</td></tr><tr><td align="center">command</td><td align="center">Optional</td><td align="center">[&quot;kube-bench&quot;, &quot;run&quot;, &quot;--targets&quot;, &quot;node&quot;,&quot;--benchmark&quot;, &quot;eks-1.0&quot;]</td><td align="center">List of <a href="https://github.com/aquasecurity/kube-bench/blob/main/docs/flags-and-commands.md" target="_blank" rel="noopener noreferrer">command</a> for running the test.</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="under-the-hood"></a>Under the hood<a class="hash-link" href="#under-the-hood" title="Direct link to heading">#</a></h2><p>Great, we now have the setup done. Let&#x27;s figure out how it works.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="how-to-scan-the-kubernetes-cluster-which-is-running-on-aws-eks"></a>How to scan the kubernetes cluster which is running on AWS (EKS)?<a class="hash-link" href="#how-to-scan-the-kubernetes-cluster-which-is-running-on-aws-eks" title="Direct link to heading">#</a></h3><ul><li>By Running the below command, we can scan the Kubernetes cluster which is configured as current-context in ~/.kube/config. </li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew clean kubeScanning</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Firstly, it will clone the kube-bench repo with a tag to build/kube-scanning/kube-bench folder. As in the below illustration: </li></ul><p><img alt="kube-bench-repo" src="/integration-server-gradle-plugin/assets/images/kube-bench-repo-1d5e8dedccdf9bad50032aff877c74f7.png"></p><ul><li>Next, execute the steps for <a href="https://github.com/aquasecurity/kube-bench/blob/main/docs/running.md#running-in-an-eks-cluster" target="_blank" rel="noopener noreferrer">AWS-EKS-Cluster</a><ul><li>Create the repository in AWS ECR </li><li>Take docker build of kube-bench with tag</li><li>Push the created image to AWS ECR</li><li>Update the job-eks.yaml with the latest image which we generate in a previous step and run the job.</li></ul></li></ul><p><img alt="kube-bench-aws-eks-command" src="/integration-server-gradle-plugin/assets/images/kube-bench-aws-command-fff41d238a00d0d7b4c6df9a6ad69602.png"></p><ul><li><p>Once the above command execution is completed, we can find the report in build/kube-scanning/report folder, like the below sample log.</p><p><img alt="kube-bench-aws-eks-report" src="/integration-server-gradle-plugin/assets/images/kube-bench-aws-eks-report-5d522083a5f071bc33e31af5b835efda.png"></p></li></ul><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p><img alt="note" src="/integration-server-gradle-plugin/assets/images/worker-node-note-fddb274e34872363e56e4c1c855df58e.png"></p></div></div></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/integration-server-gradle-plugin/blog/tags/kube-scanning-tests">kube-scanning-tests</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/integration-server-gradle-plugin/blog/2021/09/02/run-integration-test">How to run a simple integration test</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-09-02T00:00:00.000Z" itemprop="datePublished">September 2, 2021</time> 路 5 min read</div></header><div class="markdown" itemprop="articleBody"><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="requirements"></a>Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">#</a></h3><p>Documentation is applicable for a version <strong>10.3.0-902.1243</strong> or later.</p><p>The version of the plugin contains not random values, but you can read it next way
10.3.0 means that it works for Deploy 10.3.0</p><p>After the dash is the information about the time when it was released: <br>
902 - 2nd of September <br>
1020 - 10:20 AM <br></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h3><p>I expect that you are the beginner of using this plugin, and your intention is to create your first integration test
for your custom plugin in against running Deploy instance. </p><p>At this moment you can run only Jython based tests which are executed via CLI.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">integrationServer {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    clis {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        cli {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            version = &quot;10.3.0-902.1430&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    servers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        controlPlane {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabs/xl-deploy&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            version = &quot;10.2.2&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    tests {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        testScenario01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            baseDirectory = file(&quot;src/test/jython/scenarios&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            extraClassPath = [file(&quot;src/test/jython/py-classpath&quot;)]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tearDownScripts = [&#x27;teardown.py&#x27;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In CLI section we specify the version which is available publicly. It can mismatch with Deploy server.
Most of the time it is backward compatible. Specially for the usage of it inside of integration server CLI was changed,
therefore you can&#x27;t use CLI with a lower version than <code>10.3.0-902.1430</code>. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="test-section-explanation"></a>Test section explanation<a class="hash-link" href="#test-section-explanation" title="Direct link to heading">#</a></h3><p>In tests section, you can create multiple test sections. At this blog we will take a look at the simplest configuration required.
First of all, you have to define where are your all tests resides, what is the base directory of it.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">baseDirectory = file(&quot;src/test/jython/scenarios&quot;)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This is exactly what we do here. Then you can create sub-folders and keep each scenario in own folder.</p><p>CLI is a java process which has own classpath and can contain inside the python modules so that you can have access to them from your tests.
Quite useful to keep there the shared utils. For example, it can be assertion tools or variables (like in teardown script to know what to scrape out).
For that you can add extra folders to a default classpath strategy of CLI by</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">extraClassPath = [file(&quot;src/test/jython/py-classpath&quot;)]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Default strategy to compose a classpath for CLI can be found in <code>cli.(sh|cmd)</code> script. Namely, these lines (for *.sh):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">each</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">ls</span><span class="token variable" style="color:#36acaa"> hotfix/*.jar lib/*.jar plugins/*.jar </span><span class="token variable operator file-descriptor important" style="color:#393A34">2</span><span class="token variable operator" style="color:#393A34">&gt;</span><span class="token variable" style="color:#36acaa">/dev/null</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> -f </span><span class="token variable" style="color:#36acaa">$each</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">DEPLOYIT_CLI_CLASSPATH</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${DEPLOYIT_CLI_CLASSPATH}</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">${each}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>So it means that you can also leverage from creating your own python module, archive it as <code>jar</code> and use <code>overlays</code> to
place it in CLI as a <code>plugin</code> or a <code>lib</code>. You can take it as an alternative whenever you have to reuse same logic across
multiple repositories. </p></div></div><p>When test has finished, successfully or not, it is a good practice to clean up everything what test created.
This configuration is exactly for this purpose:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tearDownScripts = [&#x27;teardown.py&#x27;]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Full set of options for this section you can find here:
<a href="https://xebialabs.github.io/integration-server-gradle-plugin/docs/getting-started/configuration#tests-section" target="_blank" rel="noopener noreferrer">https://xebialabs.github.io/integration-server-gradle-plugin/docs/getting-started/configuration#tests-section</a> </p><p>For a full version of this configuration file (and the project), have look at an example:
<a href="https://github.com/acierto/xld-simple-itest" target="_blank" rel="noopener noreferrer">https://github.com/acierto/xld-simple-itest</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="under-the-hood"></a>Under the hood<a class="hash-link" href="#under-the-hood" title="Direct link to heading">#</a></h2><p>Great, we set it up. Let&#x27;s figure out how it works.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="downloading-flow"></a>Downloading flow<a class="hash-link" href="#downloading-flow" title="Direct link to heading">#</a></h3><p>We download a server and CLI to a build folder. As you can see it on the picture: </p><p><img alt="cli-and-server" src="/integration-server-gradle-plugin/assets/images/downloading-server-and-cli-8c017b86ea6b473707999f2871e1fd27.png"></p><p>As we didn&#x27;t apply any modification sections as <code>overlays</code>, <code>copyBuildArtifacts</code>, etc. the structure and content there
would be same as from Nexus/Docker image.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="test-execution-and-troubleshooting"></a>Test execution and troubleshooting<a class="hash-link" href="#test-execution-and-troubleshooting" title="Direct link to heading">#</a></h3><p>Test runner is looking at the configurations, searching for a base folder to scan there files and then creates a sequence of them to execute.
As we have only 1 test and 1 teardown script we will see as a source for CLI 2 tests. I&#x27;ll refer to the available logs produced
by GitHub Actions <a href="https://github.com/acierto/xld-simple-itest/runs/3495662609" target="_blank" rel="noopener noreferrer">https://github.com/acierto/xld-simple-itest/runs/3495662609</a>.</p><p>There we can find the next log snippet: <img alt="Log snippet" src="/integration-server-gradle-plugin/assets/images/gradle-logs-related-to-running-cli-0931bf82a311a08948d7a614bdfd9ad8.png"></p><p>What is interesting to see here for us: <br></p><ul><li><p>To pay attention to that we connect to a non-default port <code>-port 43735</code>. In a server section we didn&#x27;t specify
the fixed port, so we are running it on a random. It&#x27;s very important if you want to run several tests in parallel and to not clash
by using the same port. CLI picks that information by reading in the file <code>conf/deployit.conf</code> a property value for a key <code>http.port</code>.</p></li><li><p>As we didn&#x27;t define a socket port, it is running with a timeout of 1 minute: <code>-socketTimeout 60000</code>. If you&#x27;ll have some long-running scripts which
will take longer than that, this is a place to tune it. </p></li><li><p>As order of Python test execution matters, you can check it out in an option <code>-source</code>. In this example we can see the next:</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">-source /home/runner/work/xld-simple-itest/xld-simple-itest/src/test/jython/scenarios/create-ci.py,/home/runner/work/xld-simple-itest/xld-simple-itest/src/test/jython/scenarios/teardown.py</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>All the logs related to a CLI execution will be saved in <code>&lt;CLI_HOME&gt;/log</code> and exact location for this log is also specified, for a convenience of troubleshooting:
<code>/home/runner/work/xld-simple-itest/xld-simple-itest/build/integration-server/xl-deploy-10.3.0-902.941-cli/log/test-0e873cfc.log</code>.
After each re-run we remove old logs to not be buried under multiple versions of it. Be aware to copy it to another location if you&#x27;d like to preserve it.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/integration-server-gradle-plugin/blog/tags/integration-test">integration-test</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/integration-server-gradle-plugin/docs/intro">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/integration-server-gradle-plugin/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/xebialabs/integration-server-gradle-plugin" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 漏 2023 Integration Server Digital.ai</div></div></div></footer></div>
<script src="/integration-server-gradle-plugin/assets/js/runtime~main.32fb6fb3.js"></script>
<script src="/integration-server-gradle-plugin/assets/js/main.9dc28fe7.js"></script>
</body>
</html>