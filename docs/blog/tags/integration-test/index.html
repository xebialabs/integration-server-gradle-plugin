<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<link rel="alternate" type="application/rss+xml" href="/integration-server-gradle-plugin/blog/rss.xml" title="Integration Server Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/integration-server-gradle-plugin/blog/atom.xml" title="Integration Server Blog Atom Feed"><title data-react-helmet="true">One post tagged with &quot;integration-test&quot; | Integration Server</title><meta data-react-helmet="true" property="og:title" content="One post tagged with &quot;integration-test&quot; | Integration Server"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://xebialabs.github.io//integration-server-gradle-plugin/blog/tags/integration-test"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="/integration-server-gradle-plugin/img/digital_ai_deploy.svg"><link data-react-helmet="true" rel="canonical" href="https://xebialabs.github.io//integration-server-gradle-plugin/blog/tags/integration-test"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io//integration-server-gradle-plugin/blog/tags/integration-test" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io//integration-server-gradle-plugin/blog/tags/integration-test" hreflang="x-default"><link rel="stylesheet" href="/integration-server-gradle-plugin/assets/css/styles.c8cb9dad.css">
<link rel="preload" href="/integration-server-gradle-plugin/assets/js/runtime~main.2fcc57d4.js" as="script">
<link rel="preload" href="/integration-server-gradle-plugin/assets/js/main.e913ce04.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/integration-server-gradle-plugin/"><img src="/integration-server-gradle-plugin/img/digital_ai_deploy.svg" alt="Integration Server Deploy Digital.ai" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/integration-server-gradle-plugin/img/digital_ai_deploy.svg" alt="Integration Server Deploy Digital.ai" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Integration Server</b></a><a class="navbar__item navbar__link" href="/integration-server-gradle-plugin/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/integration-server-gradle-plugin/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/integration-server-gradle-plugin/docs/intro">10.4.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/integration-server-gradle-plugin/docs/intro">10.4.0</a></li><li><a class="dropdown__link" href="/integration-server-gradle-plugin/docs/10.3.0/intro">10.3.0</a></li></ul></div><a href="https://github.com/xebialabs/integration-server-gradle-plugin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/integration-server-gradle-plugin/blog/2021/09/02/run-integration-test">How to run a simple integration test</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;integration-test&quot;</h1><a href="/integration-server-gradle-plugin/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/integration-server-gradle-plugin/blog/2021/09/02/run-integration-test">How to run a simple integration test</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-09-02T00:00:00.000Z" itemprop="datePublished">September 2, 2021</time> Â· 5 min read</div></header><div class="markdown" itemprop="articleBody"><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="requirements"></a>Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">#</a></h3><p>Documentation is applicable for a version <strong>10.3.0-902.1243</strong> or later.</p><p>The version of the plugin contains not random values, but you can read it next way
10.3.0 means that it works for Deploy 10.3.0</p><p>After minus the information of the time when it was released: <br>
902 - 2nd of September <br>
1020 - 10:20 AM <br></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h3><p>I expect that you are the beginner of using this plugin, and your intention is to create your first integration test
for your custom plugin in against running Deploy instance. </p><p>At this moment you can run only Jython based tests which are executed via CLI.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">integrationServer {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    clis {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        cli {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            version = &quot;10.3.0-902.1430&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    servers {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        controlPlane {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dockerImage = &quot;xebialabs/xl-deploy&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            version = &quot;10.2.2&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    tests {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        testScenario01 {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            baseDirectory = file(&quot;src/test/jython/scenarios&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            extraClassPath = [file(&quot;src/test/jython/py-classpath&quot;)]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tearDownScripts = [&#x27;teardown.py&#x27;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In CLI section we specify the version which is available publicly. It can mismatch with Deploy server.
Most of the time it is backward compatible. Specially for the usage of it inside of integration server CLI was changed,
therefore you can&#x27;t use CLI with a lower version than <code>10.3.0-902.1430</code>. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="test-section-explanation"></a>Test section explanation<a class="hash-link" href="#test-section-explanation" title="Direct link to heading">#</a></h3><p>In tests section, you can create multiple test sections. At this blog we will take a look at the simplest configuration required.
First of all, you have to define where are your all tests resides, what is the base directory of it.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">baseDirectory = file(&quot;src/test/jython/scenarios&quot;)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This is exactly what we do here. Then you can create sub-folders and keep each scenario in own folder.</p><p>CLI is a java process which has own classpath and can contain inside the python modules so that you can have access to them from your tests.
Quite useful to keep there the shared utils. For example, it can be assertion tools or variables (like in teardown script to know what to scrape out).
For that you can add extra folders to a default classpath strategy of CLI by</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">extraClassPath = [file(&quot;src/test/jython/py-classpath&quot;)]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Default strategy to compose a classpath for CLI can be found in <code>cli.(sh|cmd)</code> script. Namely, these lines (for *.sh):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">each</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">ls</span><span class="token variable" style="color:#36acaa"> hotfix/*.jar lib/*.jar plugins/*.jar </span><span class="token variable operator file-descriptor important" style="color:#393A34">2</span><span class="token variable operator" style="color:#393A34">&gt;</span><span class="token variable" style="color:#36acaa">/dev/null</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> -f </span><span class="token variable" style="color:#36acaa">$each</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">DEPLOYIT_CLI_CLASSPATH</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${DEPLOYIT_CLI_CLASSPATH}</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">${each}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>So it means that you can also leverage from creating your own python module, archive it as <code>jar</code> and use <code>overlays</code> to
place it in CLI as a <code>plugin</code> or a <code>lib</code>. You can take it as an alternative whenever you have to reuse same logic across
multiple repositories. </p></div></div><p>When test has finished, successfully or not, it is a good practice to clean up everything what test created.
This configuration is exactly for this purpose:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tearDownScripts = [&#x27;teardown.py&#x27;]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Full set of options for this section you can find here:
<a href="https://xebialabs.github.io/integration-server-gradle-plugin/docs/getting-started/configuration#tests-section" target="_blank" rel="noopener noreferrer">https://xebialabs.github.io/integration-server-gradle-plugin/docs/getting-started/configuration#tests-section</a> </p><p>For a full version of this configuration file (and the project), have look at an example:
<a href="https://github.com/acierto/xld-simple-itest" target="_blank" rel="noopener noreferrer">https://github.com/acierto/xld-simple-itest</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="under-the-hood"></a>Under the hood<a class="hash-link" href="#under-the-hood" title="Direct link to heading">#</a></h2><p>Great, we set it up. Let&#x27;s figure out how it works.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="downloading-flow"></a>Downloading flow<a class="hash-link" href="#downloading-flow" title="Direct link to heading">#</a></h3><p>We download a server and CLI to a build folder. As you can see it on the picture: </p><p><img alt="cli-and-server" src="/integration-server-gradle-plugin/assets/images/downloading-server-and-cli-8c017b86ea6b473707999f2871e1fd27.png"></p><p>As we didn&#x27;t apply any modification sections as <code>overlays</code>, <code>copyBuildArtifacts</code>, etc. the structure and content there
would be same as from Nexus/Docker image.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="test-execution-and-troubleshooting"></a>Test execution and troubleshooting<a class="hash-link" href="#test-execution-and-troubleshooting" title="Direct link to heading">#</a></h3><p>Test runner is looking at the configurations, searching for a base folder to scan there files and then creates a sequence of them to execute.
As we have only 1 test and 1 teardown script we will see as a source for CLI 2 tests. I&#x27;ll refer to the available logs produced
by GitHub Actions <a href="https://github.com/acierto/xld-simple-itest/runs/3495662609" target="_blank" rel="noopener noreferrer">https://github.com/acierto/xld-simple-itest/runs/3495662609</a>.</p><p>There we can find the next log snippet: <img alt="Log snippet" src="/integration-server-gradle-plugin/assets/images/gradle-logs-related-to-running-cli-0931bf82a311a08948d7a614bdfd9ad8.png"></p><p>What is interesting to see here for us: <br></p><ul><li><p>To pay attention to that we connect to a non-default port <code>-port 43735</code>. In a server section we didn&#x27;t specify
the fixed port, so we are running it on a random. It&#x27;s very important if you want to run several tests in parallel and to not clash
by using the same port. CLI picks that information by reading in the file <code>conf/deployit.conf</code> a property value for a key <code>http.port</code>.</p></li><li><p>As we didn&#x27;t define a socket port, it is running with a timeout of 1 minute: <code>-socketTimeout 60000</code>. If you&#x27;ll have some long-running scripts which
will take longer than that, this is a place to tune it. </p></li><li><p>As order of Python test execution matters, you can check it out in an option <code>-source</code>. In this example we can see the next:</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">-source /home/runner/work/xld-simple-itest/xld-simple-itest/src/test/jython/scenarios/create-ci.py,/home/runner/work/xld-simple-itest/xld-simple-itest/src/test/jython/scenarios/teardown.py</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>All the logs related to a CLI execution will be saved in <code>&lt;CLI_HOME&gt;/log</code> and exact location for this log is also specified, for a convenience of troubleshooting:
<code>/home/runner/work/xld-simple-itest/xld-simple-itest/build/integration-server/xl-deploy-10.3.0-902.941-cli/log/test-0e873cfc.log</code>.
After each re-run we remove old logs to not be buried under multiple versions of it. Be aware to copy it to another location if you&#x27;d like to preserve it.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/integration-server-gradle-plugin/blog/tags/integration-test">integration-test</a></li></ul></div><div class="col col--3 text--right"><a aria-label="Read more about How to run a simple integration test" href="/integration-server-gradle-plugin/blog/2021/09/02/run-integration-test"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/integration-server-gradle-plugin/docs/intro">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/integration-server-gradle-plugin/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/xebialabs/integration-server-gradle-plugin" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Integration Server Digital.ai</div></div></div></footer></div>
<script src="/integration-server-gradle-plugin/assets/js/runtime~main.2fcc57d4.js"></script>
<script src="/integration-server-gradle-plugin/assets/js/main.e913ce04.js"></script>
</body>
</html>